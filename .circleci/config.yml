version: 2.1

parameters:
  is_branch_update:
    type: string
    default: "yes"

orbs:
  newman: postman/newman@1.0.0

executors:
  postman_newman:
    description: Official newman docker image - https://hub.docker.com/r/postman/newman
    docker:
      - image: postman/newman:<<parameters.tag>>
    parameters:
      tag:
        default: latest
        description: Tag for postman/newman docker image - https://hub.docker.com/r/postman/newman/tags
        type: string

jobs:
  test_postman:
    executor: postman_newman
    steps:
      - checkout
      - newman/newman-run:
          collection: ./Menv2Coll.json
          environment: ./Menv2env.json

workflows:
  version: 2.1
  postman-workflow:
    when:
      equal: [<< pipeline.parameters.is_branch_update >>, "yes"]
    triggers:
      - schedule:
          cron: "16 18 * * *"
          filters:
            branches:
              only:
                - main
    jobs:
      - test_postman